<?xml version="1.0" ?>
<!--
     Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)

     SPDX-License-Identifier: BSD-2-Clause
-->

<api name="ObjectApiAarch32" label_prefix="aarch32_">
    <struct name="seL4_UserContext">
        <member name="pc"/>
        <member name="sp"/>
        <member name="cpsr"/>
        <member name="r0"/>
        <member name="r1"/>
        <member name="r8"/>
        <member name="r9"/>
        <member name="r10"/>
        <member name="r11"/>
        <member name="r12"/>
        <member name="r2"/>
        <member name="r3"/>
        <member name="r4"/>
        <member name="r5"/>
        <member name="r6"/>
        <member name="r7"/>
        <member name="r14"/>
        <member name="tpidrurw"/>
        <member name="tpidruro"/>
    </struct>
    <interface name="seL4_ARM_PageDirectory" manual_name="Page Directory"
        cap_description="Capability to the page directory being operated on.">
        <method id="ARMPDRange_Protect" name = "Range_Protect"
            manual_name="PD Range Protect" manual_label="pd_range_protect">
            <brief>
                Unmap or protect a range of pages in this vspace
            </brief>
            <description>
                Unmap/protect a range of pages in this vspace. This call can only decrease access to pages, not increase.
                A single invocation will consider at most 32 pages before returning to the caller. It will return the virtual address
                after the last page which was considered as well as the number of pages which were protected/unmapped.
            </description>
            <param dir="in" name="start_vaddr" type="seL4_Word"
                   description="The starting address of the first page to be considered. Should be page aligned"/>
            <param dir="in" name="end_vaddr" type="seL4_Word">
                <description>
                   The end of the range to consider (non-inclusive). Should be page aligned.
                </description>
            </param>
            <param dir="in" name="rights" type="seL4_CapRights_t">
                <description>
                   The minimum protection to protect each page to (if possible). For example <texttt text="seL4_CanRead"/>
                   will make any read/write pages read only but will not change any pages that are already mapped with <texttt text="seL4_NoRights"/>.
                   If <texttt text="seL4_AllRights"/> is the provided protection level, this call will unmap the page instead.
                </description>
            </param>
            <param dir="out" name="next_vaddr" type="seL4_Word"
                   description="The staring address of the page after the one which was last considered "/>
            <param dir="out" name="num" type="seL4_Uint8"
                   description="The number of pages which were actually considered in the range (non-empty pages)"/>
            <error name="seL4_FailedLookup">
                <description>
                    The <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_InvalidCapability">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
            <error name="seL4_InvalidArgument">
            <description>
                <texttt text="end_vaddr"/> is before <texttt text="start_vaddr"/>.
                Or, <texttt text="end_vaddr"/> is beyond than the user addressable region.
            </description>
            </error>
            <error name="seL4_AlignmentError">
                <description>
                    <texttt text="start_vaddr"/> or <texttt text="end_vaddr"/> is not page aligned.
                </description>
            </error>
        </method>
        <method id = "ARMPDPage_Map" name = "Page_Map"
                manual_name="PD page map" manual_label="pd_page_map">
            <brief>
                Map a frame to a virtual address in the provided vspace.
            </brief>
            <description>
                Given a virtual address in the vspace, maps this virtual address to the frame with a given capability.  If the given virtual adress is already mapped to a different
                frame, this mapping will be overwritten. If <texttt text="frame"/> is already mapped to a page but does not back it, the mapping will be considered stale and
                overwritten. If the frame capability does back a page, the mapping will not be overwritten and this system call will fail.
            </description>
            <param dir="in" name="frame" type="seL4_CPtr"
                    description="A capability to the frame which is to be used for the mapping"/>
            <param dir="in" name="vaddr" type="seL4_Word"
                    description="The virtual address of the start of the page which is to be mapped. Must be page-aligned"/>
            <param dir="in" name="rights" type="seL4_CapRights_t">
                <description>
                    "Rights for the mapping.<docref>Possible values for this type are given in <autoref label="sec:cap_rights"/>  .</docref>"
                </description>
            </param>
            <param dir="in" name="attr" type="seL4_ARM_VMAttributes">
                <description>
                    "VM Attributes for the mapping.<docref>Possible values for this type are given in <autoref label="ch:vspace"/>  .</docref>"
                </description>
            </param>
            <error name="seL4_AlignmentError">
            <description>
                The <texttt text="vaddr"/> is not aligned to the page size of <texttt text="frame"/>.
            </description>
            </error>
            <error name="seL4_FailedLookup">
                <description>
                    The <texttt text="_service"/> does not have a paging structure at the required level mapped at <texttt text="vaddr"/>.
                    Or, <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_InvalidArgument">
                <description>
                    The <texttt text="frame"/> is already backing a different page in <texttt text="_service"/>.
                    Or, <texttt text="vaddr"/> is in the kernel virtual address range.
                </description>
            </error>
            <error name="seL4_InvalidCapability">
                <description>
                    The <texttt text="frame"/> or <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="_service"/> is not assigned to an ASID pool.
                    Or, <texttt text="frame"/> is already mapped in a different VSpace.
                </description>
            </error>
        </method>
        <method id="ARMPDClean_Data" name="Clean_Data" manual_name="Clean Data" manual_label="pd_clean">
                <brief>
                    Clean cached pages within a page directory
                </brief>
                <description>
                    <docref>See <autoref label="ch:vspace"/>.</docref>
                </description>
            <param dir="in" name="start" type="seL4_Word"
            description="Start address"/>
            <param dir="in" name="end" type="seL4_Word"
            description="End address"/>
            <error name="seL4_FailedLookup">
                <description>
                    The <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="start"/> or <texttt text="end"/> is in the kernel virtual address range.
                </description>
            </error>
            <error name="seL4_InvalidArgument">
                <description>
                    The <texttt text="start"/> is greater than or equal to <texttt text="end"/>.
                </description>
            </error>
            <error name="seL4_InvalidCapability">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_RangeError">
                <description>
                    The specified range crosses a page boundary.
                </description>
            </error>
        </method>
        <method id="ARMPDInvalidate_Data" name="Invalidate_Data" manual_name="Invalidate Data" manual_label="pd_invalidate">
                <brief>
                    Invalidate cached pages within a page directory
                </brief>
             <description>
                 <docref>See <autoref label="ch:vspace"/>.</docref>
             </description>
            <param dir="in" name="start" type="seL4_Word"
            description="Start address"/>
            <param dir="in" name="end" type="seL4_Word"
            description="End address"/>
            <error name="seL4_FailedLookup">
                <description>
                    The <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="start"/> or <texttt text="end"/> is in the kernel virtual address range.
                </description>
            </error>
            <error name="seL4_InvalidArgument">
                <description>
                    The <texttt text="start"/> is greater than or equal to <texttt text="end"/>.
                </description>
            </error>
            <error name="seL4_InvalidCapability">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_RangeError">
                <description>
                    The specified range crosses a page boundary.
                </description>
            </error>
        </method>
        <method id="ARMPDCleanInvalidate_Data" name="CleanInvalidate_Data"
            manual_name="Clean and Invalidate Data" manual_label="pd_clean_invalidate">
                <brief>
                    Clean and invalidate cached pages within a page directory
                </brief>
             <description>
                 <docref>See <autoref label="ch:vspace"/>.</docref>
             </description>
            <param dir="in" name="start" type="seL4_Word"
            description="Start address"/>
            <param dir="in" name="end" type="seL4_Word"
            description="End address"/>
            <error name="seL4_FailedLookup">
                <description>
                    The <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="start"/> or <texttt text="end"/> is in the kernel virtual address range.
                </description>
            </error>
            <error name="seL4_InvalidArgument">
                <description>
                    The <texttt text="start"/> is greater than or equal to <texttt text="end"/>.
                </description>
            </error>
            <error name="seL4_InvalidCapability">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_RangeError">
                <description>
                    The specified range crosses a page boundary.
                </description>
            </error>
        </method>
        <method id="ARMPDUnify_Instruction" name="Unify_Instruction" manual_name="Unify Instruction" manual_label="pd_unify_instruction">
                <brief>
                    Clean and invalidate cached instruction pages to point of unification
                </brief>
             <description>
                 <docref>See <autoref label="ch:vspace"/>.</docref>
             </description>
            <param dir="in" name="start" type="seL4_Word"
            description="Start address"/>
            <param dir="in" name="end" type="seL4_Word"
            description="End address"/>
            <error name="seL4_FailedLookup">
                <description>
                    The <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="start"/> or <texttt text="end"/> is in the kernel virtual address range.
                </description>
            </error>
            <error name="seL4_InvalidArgument">
                <description>
                    The <texttt text="start"/> is greater than or equal to <texttt text="end"/>.
                </description>
            </error>
            <error name="seL4_InvalidCapability">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_RangeError">
                <description>
                    The specified range crosses a page boundary.
                </description>
            </error>
        </method>
    </interface>
</api>
